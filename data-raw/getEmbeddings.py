import pandas as pd
import openai
import os
import numpy as np
import json

# Assuming an Open AI API Key is loaded in the environment variables
client = openai.OpenAI(api_key=os.environ.get("OPENAI_API_KEY"))
embedding_model = "text-embedding-3-small"

DIMS = 3072

def get_embeddings(texts, **kwargs):
    # Get embeddings from the OpenAI API
    
    # Dummy implementation:
    # return [np.random.random((3072))] * len(texts)
  
    # Batching, since we need lists just barely longer than the API limit
    MAX_BATCH_SIZE = 2048
    def chunker(seq, size):
        return (seq[pos:pos + size] for pos in range(0, len(seq), size))
    
    embeddings_data = []
    
    for chunk in chunker(texts, MAX_BATCH_SIZE):
        response = client.embeddings.create(input=chunk, model=embedding_model, **kwargs)
        chunk_embeddings = response.data
        embeddings_data.extend(chunk_embeddings)
    
    return [x.embedding for x in embeddings_data]


kanji = ["人","一","大","日","出","中","本","年","上","子","生","手","見","入","立","下","学","目","月","小","女","名","気","三","山","田","二","力","文","川","金","口","水","車","男","正","先","十","天","音","木","空","村","四","五","石","白","校","町","足","王","八","土","九","千","字","六","早","右","円","青","左","火","花","七","赤","百","草","森","林","玉","休","雨","竹","耳","夕","犬","虫","糸","貝","行","分","時","間","自","後","国","地","合","前","方","会","場","言","家","長","同","体","作","高","当","内","通","来","用","道","理","明","知","新","心","社","外","書","多","東","話","教","野","近","数","思","語","原","少","回","海","考","記","電","引","今","公","強","画","元","市","直","切","番","何","食","太","京","頭","線","形","組","活","親","点","声","朝","楽","馬","色","北","門","光","半","西","聞","広","父","風","万","古","母","台","戸","売","店","計","交","帰","止","夜","首","室","南","歩","走","船","工","顔","黒","歌","細","読","寺","谷","米","遠","図","友","科","紙","星","買","園","春","答","兄","肉","秋","丸","角","弟","毎","茶","岩","夏","算","絵","羽","里","週","毛","鳥","鳴","雪","弱","池","曜","雲","黄","刀","午","姉","魚","矢","晴","冬","妹","才","昼","牛","弓","麦","汽","事","者","部","代","動","物","発","度","実","世","所","主","対","持","意","全","身","開","取","定","面","神","向","業","表","化","使","平","相","次","屋","第","様","重","受","死","界","和","指","島","問","味","員","流","決","美","感","安","着","真","集","期","運","品","進","葉","命","放","調","有","起","勝","題","他","由","始","両","終","都","送","乗","落","仕","配","反","役","式","路","転","住","悪","打","助","院","族","係","想","急","返","号","宮","消","待","追","予","客","等","守","深","病","横","局","鉄","根","息","去","投","育","階","血","球","州","登","商","注","橋","館","県","医","速","曲","福","旅","波","君","区","負","苦","銀","服","研","洋","写","昭","究","申","列","具","駅","酒","幸","軽","坂","陽","談","薬","暗","飲","宿","短","章","庭","遊","習","板","級","温","整","岸","礼","港","央","庫","植","農","悲","練","委","筆","丁","皮","祭","湯","油","詩","荷","昔","歯","箱","漢","倍","湖","鼻","緑","寒","童","豆","柱","氷","帳","秒","炭","畑","勉","拾","泳","皿","羊","暑","笛","的","戦","最","関","以","不","機","軍","連","成","法","結","変","無","信","要","初","置","別","民","続","説","兵","加","付","特","治","利","伝","議","然","必","残","氏","果","夫","選","愛","隊","井","官","城","好","側","産","約","共","位","達","参","料","建","松","飛","種","良","失","器","争","観","単","佐","念","笑","例","類","満","覚","府","差","改","英","岡","察","周","害","望","験","老","量","求","司","末","帯","崎","熱","清","案","陸","完","辺","香","低","各","令","景","街","試","芸","働","席","極","静","未","管","録","徳","照","冷","挙","積","協","仲","労","敗","散","材","倉","臣","省","願","博","富","奈","折","印","底","焼","競","児","養","固","康","輪","給","節","群","健","功","徒","便","阪","鹿","束","賀","典","課","順","標","衣","浅","包","栄","候","辞","卒","欠","札","鏡","孫","飯","希","借","勇","灯","熊","泣","郡","貨","副","季","浴","億","昨","縄","沖","旗","塩","梅","牧","唱","訓","努","菜","祝","岐","械","漁","票","梨","刷","巣","潟","径","兆","芽","滋","阜","埼","茨","栃","媛","現","性","在","能","経","情","解","政","士","得","義","報","務","保","常","際","状","殺","件","確","衛","制","過","可","武","判","術","団","張","応","格","支","師","態","造","構","任","質","勢","断","設","示","備","素","容","告","再","居","演","総","限","史","型","移","独","寄","条","紀","識","基","護","接","像","領","職","証","査","久","資","技","象","営","絶","統","非","河","破","比","囲","程","精","増","編","志","興","製","個","価","妻","提","境","似","防","眼","修","許","織","犯","評","検","復","歴","規","雑","故","余","堂","布","導","永","留","準","喜","率","属","険","罪","述","賞","版","効","逆","圧","夢","授","略","因","弁","財","減","婦","航","費","仏","旧","額","豊","混","刊","暴","祖","快","築","易","適","救","責","測","講","停","舎","仮","禁","則","複","採","厚","迷","燃","毒","幹","枝","輸","句","液","税","慣","益","招","桜","酸","謝","損","墓","績","貸","災","貧","往","脈","均","飼","賛","粉","序","耕","肥","銅","鉱","綿","貯","貿","潔","呼","私","存","論","権","視","供","若","映","認","降","優","警","異","座","将","姿","段","派","装","難","背","退","皇","収","巻","蔵","済","割","従","源","宗","敵","密","系","処","党","並","乱","激","裏","域","探","貴","遺","片","疑","諸","危","泉","射","衆","宇","展","我","担","策","聖","亡","傷","専","刻","幕","宅","訪","除","盛","値","劇","腹","推","誌","閉","秘","模","補","訳","忠","翌","裁","窓","困","枚","吸","痛","革","胸","骨","暮","承","著","純","樹","染","至","筋","宝","納","厳","善","郷","勤","障","欲","創","操","否","層","簡","株","宙","宣","砂","脳","討","忘","延","幼","捨","就","律","己","揮","庁","晩","洗","閣","穴","尊","届","奏","乳","頂","拡","盟","紅","敬","仁","憲","批","針","縮","沿","誤","棒","署","看","干","詞","拝","臓","潮","券","臨","銭","誠","誕","舌","覧","孝","預","縦","郵","灰","暖","垂","卵","奮","恩","熟","俳","冊","寸","蒸","朗","賃","糖","磁","尺","机","班","鋼","后","胃","腸","肺","絹","陛","俵","穀","蚕","彼","郎","込","違","撃","藤","御","吉","離","江","歳","突","影","渡","振","与","介","頃","津","頼","戻","抜","越","婚","沢","端","娘","攻","奥","舞","押","響","倒","逃","尾","誰","秀","監","弾","為","途","恐","敷","闘","魔","浮","及","描","抱","艦","載","普","隠","称","帝","殿","刑","継","掛","跡","房","緒","企","含","雄","捕","腕","甲","駆","寝","脱","督","壁","般","抗","恋","嫌","鮮","迎","払","僕","藩","拠","施","巨","触","更","況","剣","被","惑","超","奇","浜","壊","怒","妙","華","襲","換","吹","滅","爆","微","俺","替","環","縁","恵","伸","陣","踏","髪","隣","柄","怪","震","銃","驚","援","肩","薄","刺","麻","霊","玄","瞬","荒","床","遅","儀","徴","腰","瀬","互","眠","傾","占","療","砲","那","握","迫","聴","沈","躍","繰","露","絡","誘","了","竜","廃","執","避","陰","扱","奴","伏","黙","捜","濃","奪","憶","詰","依","姫","伯","騒","鬼","弥","浦","崩","奉","煙","輝","脚","到","昇","杯","騎","仰","杉","致","怖","携","紹","齢","締","充","審","詳","遣","催","訴","盗","撮","威","柳","距","叫","巡","丈","如","衝","豪","症","湾","裕","韓","狂","亜","請","伴","屈","爵","幅","輩","潜","仙","飾","慮","埋","袋","釈","塚","堀","裂","僧","盤","甘","獲","茂","又","坊","販","封","泊","鈴","慶","核","即","哲","謀","狭","邦","揺","珍","侵","摩","皆","緊","狙","範","籍","掲","項","汚","忍","患","脇","斎","呂","幾","双","芝","鶴","融","吐","維","徹","闇","炎","亀","沼","繁","隆","綱","猫","貫","悟","契","稲","抑","尽","兼","寿","俊","旦","羅","免","雅","丘","姓","耐","悩","唯","麗","欧","既","扉","浪","掘","須","涙","邪","没","較","尋","垣","斬","索","丹","尻","唐","摘","滑","趣","駄","翼","献","勘","駐","穂","虎","渉","還","抵","雷","稿","慢","烈","揚","懐","誇","沙","透","征","傍","塔","辛","獣","乾","併","柔","疲","魂","葬","覆","幻","添","尚","酔","診","塗","鋭","僚","寛","踊","菊","戒","網","眺","獄","択","俗","譲","胞","魅","懸","亭","渋","臭","軒","概","荘","棄","廊","殊","偽","邸","剤","舟","排","貞","釣","漫","拒","畳","陥","侍","挑","硬","椅","遂","鎖","曹","紫","却","斜","敏","唇","筒","偶","膝","廷","隅","虚","偵","籠","随","鍵","彩","逮","斉","泥","淡","恥","析","卓","架","遇","冒","慎","咲","召","峰","滝","嫁","削","猛","託","賢","肌","祈","誉","滞","溶","拳","紋","鎌","叔","脅","尉","裸","孤","雇","酷","罰","促","澄","鎮","駒","賊","腐","圏","洞","堅","紛","妖","逸","鑑","控","霧","芳","汗","匠","勧","隔","噴","枠","掌","掃","哀","匹","孔","晶","肝","靴","歓","愚","啓","顧","劣","稼","壇","塞","涯","磨","泰","喫","緩","跳","蹴","旨","彫","粒","焦","償","岳","謎","募","帽","惨","贈","憎","呉","刃","狩","軌","珠","冠","顕","朱","蛇","撤","頑","翻","呪","徐","脂","貌","涼","偉","嬢","佳","遭","拍","匂","膨","眉","穏","桃","悔","暦","巧","債","凍","購","浄","祥","旋","衰","嘆","凝","挨","拶","婆","暇","棚","剛","惜","拓","挟","凄","漏","崇","絞","傘","胆","湿","虐","雰","摂","戯","菌","妃","舗","菓","壮","寧","棟","蓋","銘","琴","殖","是","葛","猿","縛","袖","犠","煮","漂","塁","慌","瓶","隻","炉","粋","撲","乏","浸","幽","符","牲","克","礎","股","励","盾","倫","潰","軸","喉","履","誓","貢","忙","郊","悠","嵐","弦","鼓","鍋","陳","乙","据","棋","疾","賭","附","慰","粧","偏","塾","寂","殴","膜","禅","汁","錯","搭","顎","冗","苗","稽","湧","侯","塊","恨","癖","砕","貼","瞳","稚","謙","恒","旬","漠","陶","捉","爪","挿","宰","峠","隷","拘","艇","拭","盆","膚","帆","隙","頻","慈","緯","凶","枕","胴","需","卑","抽","鶏","恭","披","箇","宴","覇","潤","譜","粘","秩","蓄","陵","憂","鉢","扇","凡","妊","彰","括","畜","粗","墳","寮","疎","甚","措","擁","峡","崖","瓦","矛","鐘","敢","猟","郭","堤","窮","尼","辱","糧","阻","睡","溝","枯","殻","喪","把","虜","骸","鍛","桑","幣","伐","享","紳","遮","繊","膳","豚","但","悦","擦","肢","窟","縫","椎","庶","墨","缶","培","痕","傑","赴","楼","軟","囚","飽","憤","喚","鬱","勲","癒","唄","逐","轄","蜂","斗","昧","鉛","腫","堪","泡","謡","簿","妨","忌","鈍","藍","釜","閥","呈","諦","嗣","懲","碑","苛","赦","渦","勃","宜","飢","餌","媒","戚","尿","𠮟","暫","宛","濁","牙","伺","遍","裾","昆","僅","墜","戴","零","欄","蔑","錦","剰","肯","汰","衡","帥","訟","刈","朴","勅","枢","欺","愉","痴","奔","茎","燥","諾","滴","渓","坪","麓","閑","粛","曇","奨","褒","漬","胎","厄","薦","薫","蛮","怠","乞","襟","醒","詠","疫","懇","沸","岬","伎","栽","錠","妥","餅","該","妬","碁","酵","娠","訂","曖","洪","醜","遷","暁","紺","祉","盲","璧","詣","憧","芋","酬","婿","塀","怨","頓","髄","叙","吟","錬","篤","搬","柿","罵","賜","炊","肖","嫉","擬","慕","曽","翁","朽","肘","諭","蜜","拙","某","巾","濯","循","吏","詮","匿","漆","艶","侮","拐","践","弄","槽","剖","拉","藻","侶","妄","喝","桁","雌","詐","嗅","餓","唾","柵","玩","挫","儒","箸","溺","憩","鯨","肪","扶","閲","堕","渇","棺","屯","硫","迅","蛍","畔","綻","騰","嘲","虹","壌","睦","褐","唆","嫡","穫","畿","腎","倣","淫","斑","逝","抹","臼","淑","硝","爽","咽","瞭","鋳","醸","捻","韻","勾","廉","蔽","煩","冥","芯","慨","准","賄","窒","礁","猶","舶","臆","酢","舷","謹","累","踪","桟","悼","娯","惧","瑠","冶","耗","遡","畏","采","拷","弊","賠","薪","宵","殉","泌","姻","刹","愁","弧","喩","紡","腺","栓","蚊","痩","寡","瘍","坑","霜","串","酌","升","堆","且","窯","漸","梗","煎","禍","丼","繕","糾","庸","羨","璃","傲","脊","濫","陪","謁","弔","遜","旺","酎","慄","萎","賓","搾","凹","卸","租","抄","嚇","詔","畝","汎","斥","貪","緻","壱","俸","罷","窃","賦","哺","凸","痢","麺","諮","矯","辣","毀","羞","嘱","氾","箋","遵","彙","憾","惰","倹","賂","諧","衷","墾","厘","摯","款","弐","恣","丙","虞","劾","迭","沃","逓","痘","捗","酪","斤","塑","朕","憬","訃","謄","頰","塡","璽","頒","繭","楷","錮","剝"]

embeddings = get_embeddings(kanji)

df = pd.DataFrame()
df["kanji"] = kanji
df["embeddings"] = embeddings

df.to_parquet('embeddings_small.parquet', compression='gzip')
